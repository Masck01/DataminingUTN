---
title: "HousePricing"
author: "Gabriel Calderón, Nicolas Cianci"
date: "1/10/2019"
output:
  html_notebook:
    df_print: paged
    fig:height: 4
    fig:width: 6
    toc: yes
    toc_float: yes
  html_document:
    df_print: paged
    toc: yes
---
Secciones
3 Preparando los datos
  3.1 Revisión de Datos no nulos
  3.2 Revisión de datos duplicados
  3.3 Limpieza de datos
4 Modelado
  4.1 Analisis de Correlación
  4.2 Creación del modelo de Regresión lineal Multiple
  4.3 Validación del modelo
5 Evaluación
  5.1 Prueba de predicciones
6 Overfitting
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 1 Overview

# 2 Entendiendo los datos

## 2.1 Carga de Librerias

```{r Carga de librerias}
library(caret)
library(markdown)
library(knitr)
library(fastDummies)
#library(maps)
library(ggplot2)
library(corrplot)
library(dplyr)
library(psych)
library(GGally)

# Quitar la notacion cientifica
options(scipen = 999)

```


## 2.2 Carga de Datos
```{r Carga de Datos }
HP <- read.csv("house_data.csv")
HP
attach(HP)
describe(HP)
```
## 2.3 Análisis Exploratorio de Datos
## 2.3.1 Resumen del Dataset
```{r 2.3.1 Sumario del Dataset}
summary(HP)
```

## Estructura del Dataset

```{r Estructura del Dataset}
str(HP)
```


## Diagramas de Dispersion de Price vs Todos

```{r}
ggplot(data = HP, aes(x = id, y = price)) + 
  geom_point(colour = "red4") +
  ggtitle("Diagrama de dispersión") +
  labs( y  =  'Precio', x = 'ID') +
  geom_smooth(method = "lm", se = TRUE, color = "firebrick") +
  theme_gray() +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
ggplot(data = HP, aes(x = date, y = price)) + 
  geom_point(colour = "red4") +
  ggtitle("Diagrama de dispersión") +
  labs( y  =  'Precio', x = 'Fecha de venta') +
  geom_smooth(method = "lm", se = TRUE, color = "firebrick") +
  theme_gray() +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
ggplot(data = HP, aes(x = bedrooms, y = price)) + 
  geom_point(colour = "red4") +
  ggtitle("Diagrama de dispersión") +
  labs( y  =  'Precio', x = 'Habitaciones') +
  geom_smooth(method = "lm", se = TRUE, color = "firebrick") +
  theme_gray() +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
ggplot(data = HP, aes(x = bathrooms, y = price)) + 
  geom_point(colour = "red4") +
  ggtitle("Diagrama de dispersión") +
  labs( y  =  'Precio', x = 'Baños') +
  geom_smooth(method = "lm", se = TRUE, color = "firebrick") +
  theme_gray() +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
ggplot(data = HP, aes(x = sqft_living, y = price)) + 
  geom_point(colour = "red4") +
  ggtitle("Diagrama de dispersión") +
  labs( y  =  'Precio', x = 'Dimensiones de la casa') +
  geom_smooth(method = "lm", se = TRUE, color = "firebrick") +
  theme_gray() +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
ggplot(data = HP, aes(x = sqft_lot, y = price)) + 
  geom_point(colour = "red4") +
  ggtitle("Diagrama de dispersión") +
  labs( y  =  'Precio', x = 'Dimensiones del Lote') +
  geom_smooth(method = "lm", se = TRUE, color = "firebrick") +
  theme_gray() +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
ggplot(data = HP, aes(x = floors, y = price)) + 
  geom_point(colour = "red4") +
  ggtitle("Diagrama de dispersión") +
  labs( y  =  'Precio', x = 'Pisos') +
  geom_smooth(method = "lm", se = TRUE, color = "firebrick") +
  theme_gray() +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
ggplot(data = HP, aes(x = waterfront, y = price)) + 
  geom_point(colour = "red4") +
  ggtitle("Diagrama de dispersión") +
  labs( y  =  'Precio', x = 'Vista al agua') +
  geom_smooth(method = "lm", se = TRUE, color = "firebrick") +
  theme_gray() +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
ggplot(data = HP, aes(x = view, y = price)) + 
  geom_point(colour = "red4") +
  ggtitle("Diagrama de dispersión") +
  labs( y  =  'Precio', x = 'Visitas a la casa') +
  geom_smooth(method = "lm", se = TRUE, color = "firebrick") +
  theme_gray() +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
ggplot(data = HP, aes(x = condition, y = price)) + 
  geom_point(colour = "red4") +
  ggtitle("Diagrama de dispersión") +
  labs( y  =  'Precio', x = 'Condiciones de la casa(Particular)') +
  geom_smooth(method = "lm", se = TRUE, color = "firebrick") +
  theme_gray() +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
ggplot(data = HP, aes(x = grade, y = price)) + 
  geom_point(colour = "red4") +
  ggtitle("Diagrama de dispersión") +
  labs( y  =  'Precio', x = 'Grado de la casa(Estado)') +
  geom_smooth(method = "lm", se = TRUE, color = "firebrick") +
  theme_gray() +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
ggplot(data = HP, aes(x = sqft_above, y = price)) + 
  geom_point(colour = "red4") +
  ggtitle("Diagrama de dispersión") +
  labs( y  =  'Precio', x = 'Dimensiones base') +
  geom_smooth(method = "lm", se = TRUE, color = "firebrick") +
  theme_gray() +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
ggplot(data = HP, aes(x = sqft_basement, y = price)) + 
  geom_point(colour = "red4") +
  ggtitle("Diagrama de dispersión") +
  labs( y  =  'Precio', x = 'Dimensiones de Sotano') +
  geom_smooth(method = "lm", se = TRUE, color = "firebrick") +
  theme_gray() +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
ggplot(data = HP, aes(x = yr_built, y = price)) + 
  geom_point(colour = "red4") +
  ggtitle("Diagrama de dispersión") +
  labs( y  =  'Precio', x = 'Año de construcción') +
  geom_smooth(method = "lm", se = TRUE, color = "firebrick") +
  theme_gray() +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
ggplot(data = HP, aes(x = yr_renovated, y = price)) + 
  geom_point(colour = "red4") +
  ggtitle("Diagrama de dispersión") +
  labs( y  =  'Precio', x = 'Año de renovación') +
  geom_smooth(method = "lm", se = TRUE, color = "firebrick") +
  theme_gray() +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
ggplot(data = HP, aes(x = sqft_living15, y = price)) + 
  geom_point(colour = "red4") +
  ggtitle("Diagrama de dispersión") +
  labs( y  =  'Precio', x = 'Dimensiones en año 2015') +
  geom_smooth(method = "lm", se = TRUE, color = "firebrick") +
  theme_gray() +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
ggplot(data = HP, aes(x = sqft_lot15, y = price)) + 
  geom_point(colour = "red4") +
  ggtitle("Diagrama de dispersión") +
  labs( y  =  'Precio', x = 'Dimensiones lote en 2015') +
  geom_smooth(method = "lm", se = TRUE, color = "firebrick") +
  theme_gray() +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
ggplot(data = HP, aes(x = zipcode, y = price)) + 
  geom_point(colour = "red4") +
  ggtitle("Diagrama de dispersión") +
  labs( y  =  'Precio', x = 'Código postal') +
  geom_smooth(method = "lm", se = TRUE, color = "firebrick") +
  theme_gray() +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
ggplot(data = HP, aes(x = lat, y = price)) + 
  geom_point(colour = "red4") +
  ggtitle("Diagrama de dispersión") +
  labs( y  =  'Precio', x = 'Latitud') +
  geom_smooth(method = "lm", se = TRUE, color = "firebrick") +
  theme_gray() +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
ggplot(data = HP, aes(x = long, y = price)) + 
  geom_point(colour = "red4") +
  ggtitle("Diagrama de dispersión") +
  labs( y  =  'Precio', x = 'Longitud') +
  geom_smooth(method = "lm", se = TRUE, color = "firebrick") +
  theme_gray() +
  theme(plot.title = element_text(hjust = 0.5))
```
## Boxplots

```{r}
par(mfrow = c(1,2))
boxplot(price, main = "Precio")
boxplot(bedrooms, main = "Habitaciones")
boxplot(bathrooms, main = "Baños")
boxplot(sqft_living, main = "Dimensiones de la casa")
boxplot(sqft_lot, main = "Dimensiones del lote")
summary(HP[1:6])
```
```{r}
par(mfrow = c(1,2))
boxplot(floors, main = "Pisos")
boxplot(waterfront, main = "Vista al agua")
boxplot(view, main = "Vista")
boxplot(condition, main = "Estado de la casa")
boxplot(grade, main = "Grado")
summary(HP[7:11])
```

```{r}
par(mfrow = c(1,2))
boxplot(sqft_above, main = "Dimensiones Base")
boxplot(sqft_basement, main = "Dimensiones Sotano")
boxplot(yr_built, main = "Año de construcción ")
boxplot(yr_renovated, main = "Año de renovación")
boxplot(sqft_living15, main = "Dimensiones sala de estar")
boxplot(sqft_lot15, main = "Dimensiones lote 2015")
summary(HP[12:17])
```

## Graficos de Distribución

```{r}
par(mfrow = c(1,2))
pie(summary(as.factor(waterfront)), labels = c("No","Yes"), main = "Distribución de Casas con vista al agua")
pie(table(as.factor(bathrooms)), main = "Distribución de baños")
```


```{r}
par(mfrow = c(1,3))
pie(table(as.factor(bedrooms)), main = "Distribución de Habitaciones")
pie(table(as.factor(grade)),  main = "Distribución de Grado")
pie(table(as.factor(condition)), main = "Distribución de condición de las casas")
```




```{r}
par(mfrow = c(1,2))
pie(table(as.factor(floors)), main = "Distribución de pisos")
pie(table(as.factor(view)), main = "Distribución de visitas")
```

# 3 Preparando los datos

## 3.1 Revisión de datos nulos

```{r}
CantidadNulos <- sapply(HP, function(x) sum(is.na(x)))
data.frame(CantidadNulos)
```

```{r}

```

Analizando el diagrama de dispersion y la regresion lineal de date contra precio
se llego a la conclusion que el atributo no nos sirve para el modelo.


# 3.2 Revision de Datos Duplicados

```{r}
nrow(HP[duplicated(HP), ])
nrow(duplicated(HP))
```

Tiene pinta que no hay.

# 3.3 Limpieza de Datos

```{r Cambiando el formato del atributo "Date"}
HP2 <- HP
HP2$date <- ymd_hms(HP2$date)

```

```{r Cambiando el formato del atributo Waterfront}
HP2$waterfront <- as.factor(HP2$waterfront)
```

```{r Redondeo de numero de baños y pisos}
HP2$bathrooms <- floor(HP2$bathrooms)
HP2$floors <- floor(HP2$floors)
str(HP2)
summary(HP2)
```

```{r}
count(filter(HP, HP2$bedrooms > 10))
HP2 <- filter(HP, HP2$bedrooms < 10)
count(filter(HP2,HP2$sqft_basement >2000))
HP2 <- filter(HP2,HP2$sqft_basement <2000)
HP2 <- filter(HP2,HP2$bathrooms <6)


```
#Sacar Bedrooms
#Sacar Condition
#Sacar ID
#Sacar Waterfront
#Sacar Sqft_basement por colinealidad con sqft_living
#Sacar zipcode
#Sacar lat
#Sacar long
#Sacar Date
#Sacar view
#Sacar yr_renovation

```{r}
attach(HP2)
HP2 <- select(HP2, -bedrooms)
HP2 <- select(HP2, -id)
HP2 <- select(HP2, -condition)
HP2 <- select(HP2, -waterfront)
HP2 <- select(HP2, -sqft_basement)
HP2 <- select(HP2, -zipcode)
HP2 <- select(HP2, -long)
HP2 <- select(HP2, -date)
HP2 <- select(HP2, -view)
HP2 <- select(HP2, -yr_renovated)
str(HP2)
```

```{r}
#HP2 <- select(HP2, -lat)
HP2$bathrooms <- floor(HP2$bathrooms)
HP2$floors <- floor(HP2$floors)
str(HP2)

```

# 4 Modelado

## 4.1 Modelo de Regresion Lineal Multiple


```{r}
correlation <- cor(HP2)
corrplot(correlation, method = "square")
HP2 <-filter(HP2, HP2$price<1000000)
lmm <- lm(HP2$price ~ ., HP2)
summary(lmm)
plot(lmm)
```

```{r}
str(HP2)

```


